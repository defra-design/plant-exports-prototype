{% extends "layout.html" %}

{% block pageTitle %}
  [title] - Manage account - {{serviceName}} - GOV.UK
{% endblock %}

{% block beforeContent %}
{{super()}}
<div class="login-nav login-border">
  <ul class="login-nav__list">
    <li class="login-nav__list-item-new">Prototype user</li>
    <li class="login-nav__list-item-new"><a href="../account" class="govuk-link login-nav__link-new govuk-link--no-visited-state profile">Manage account</a></li>
    <li class="login-nav__list-item-new"><a href="#" class="govuk-link login-nav__link-new govuk-link--no-visited-state">Sign out</a></li>
  </ul>
</div>

<a href="javascript:history.back()" class="govuk-back-link">Back</a>
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  
  <div class="govuk-grid-column-two-thirds">

    <!-- Selected address -->
    {% set _addressID = data['address'] or 1 %}
    {% set _address = data['addresses2'][0] %}
    {% for _address2 in data['addresses2'] %}
      {% if _address2.id == _addressID %}
        {% set _address = _address2 %}
      {% endif %}
    {% endfor %}

    <!-- <h1 class="govuk-heading-xl">Are you applying to PHEATS? {{data.dave}}</h1> -->

    <h1 class="govuk-heading-xl">
      Check your answers
    </h1>

    <p class="govuk-body govuk-!-margin-bottom-9">Your application is now ready to be submitted. Check that the answers you've provided are correct.</p>

    <form method="post" novalidate action="pheats-confirmation">

      <h2 class="govuk-heading-m">Registration summary</h2>

      <dl class="govuk-summary-list govuk-!-margin-bottom-9">

        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key">
            PHEATS address
          </dt>
          <dd class="govuk-summary-list__value">
            <!-- Top Lane<br>
            Peterborough<br>
            Cambridgeshire<br>
            PO5 7HY -->
            {{_address.address1}}<br>
            {{_address.address2}}<br>
            {{_address.address3}}<br>
            {{_address.address4}}<br>
            {{_address.postcode}}
          </dd>
          <dd class="govuk-summary-list__actions">
          </dd>
        </div>

      </dl>

      <h2 class="govuk-heading-m">Site plan</h2>

      <dl class="govuk-summary-list govuk-!-margin-bottom-7">

        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key">
            File name
          </dt>
          <dd class="govuk-summary-list__value">
            <a class="govuk-link govuk-link--no-visited-state" href="#">
              {{data['pheatsSite'] or 'site-plan.pdf'}}, 2MB
            </a>
          </dd>
          <dd class="govuk-summary-list__actions">
            <a class="govuk-link govuk-link--no-visited-state" href="pheats-site">
              Change<span class="govuk-visually-hidden"> </span>
            </a>
          </dd>
        </div>

      </dl>

      <h2 class="govuk-heading-m">Commodities</h2>

      {% set _commodityCount = data['commodityCount'] or 1 | int %}

      <table class="govuk-table govuk-!-margin-bottom-7" >
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header" scope="col">Description</th>
            <th class="govuk-table__header" scope="col">Origin</th>
            <th class="govuk-table__header" scope="col">Destination</th>
            <th class="govuk-table__header" scope="col" style="text-align: right;">Actions</th>
          </tr>
        </thead>
        <tbody>

        {% for i in range(0, _commodityCount) -%}

        {% set _show = "true" %}
        {% set _id = loop.index %}
        {% set _deletedValue = data['commodityDeleted' + _id] %}
        {% if _deletedValue == "true" %}
          {% set _show = "false" %}
        {% endif %}

        {% if _show == "true" %}

        <tr class="govuk-table__row">
          <td class="govuk-table__cell">
            {{data['commodityName' + _id] or 'Dactylorhiza umbrosa (DAKUM)'}}
          </td>
          <td class="govuk-table__cell">

            {% set _originCount = data['originCount' + _id] or 1 | int %}
              {% for i in range(0, _originCount) -%}
                {% set _show = "true" %}
                {% set _originID = loop.index %}
                {% set _deletedValue = data['commodityOriginDeleted' + _id + '-' + _originID] %}
                {% if _deletedValue == "true" %}
                  {% set _show = "false" %}
                {% endif %}

                {% if _show == "true" %}
                {{data['commodityOrigin' + _id + '-' + _originID][0] or 'United Kingdom'}}{% if loop.last %}{% else %}, {% endif %}
                {% endif %}
              {%- endfor %}
            </td>
            <td class="govuk-table__cell">
            {% set _destinationCount = data['destinationCount' + _id] or 1 | int %}

              {% for i in range(0, _destinationCount) -%}
                {% set _show = "true" %}
                {% set _destinationID = loop.index %}
                {% set _deletedValue = data['commodityDestinationDeleted' + _id + '-' + _destinationID] %}
                {% if _deletedValue == "true" %}
                  {% set _show = "false" %}
                {% endif %}

                {% if _show == "true" %}
                {{data['commodityDestination' + _id + '-' + _destinationID][0] or 'France'}}{% if loop.last %}{% else %}, {% endif %}
                {% endif %}
              {%- endfor %}
            </td>
            <td class="govuk-table__cell" style="text-align: right;">
              <a class="govuk-link govuk-link--no-visited-state" href="pheats-commodities-added">
                Change<span class="govuk-visually-hidden"> </span>
              </a>
            </td>
          </tr>
        {% endif %}

        {%- endfor %}

        </tbody>
      </table>

      <h2 class="govuk-heading-m">Person responsible</h2>
    
      <table class="govuk-table govuk-!-margin-bottom-7" >
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header" scope="col">Name</th>
            <th class="govuk-table__header" scope="col">Position</th>
            <th class="govuk-table__header" scope="col">Contact details</th>
            <th class="govuk-table__header" scope="col" style="text-align: right;">Actions</th>
          </tr>
        </thead>
        <tbody>

          <tr class="govuk-table__row">
            <td class="govuk-table__cell">
              {{data['pheats-main-contact-name'] or 'Bill Shoggins'}}
            </td>
            <td class="govuk-table__cell">
              {{data['pheats-main-contact-position'] or 'Manager'}}
            </td>
            <td class="govuk-table__cell">
              <span class="govuk-!-margin-bottom-1" style="display:block">{{data['pheats-main-contact-email'] or 'bill.shoggins@acmeltd.com'}}</span>
              <span class="govuk-!-margin-bottom-1" style="display:block">{{data['pheats-main-contact-phone'] or '01234 567890'}}</span>
              <span class="govuk-!-margin-bottom-1" style="display:block">{{data['pheats-main-contact-mobile'] or '07123 456789'}}</span>
            </td>
          <td class="govuk-table__cell" style="text-align: right;">
            <a class="govuk-link govuk-link--no-visited-state" href="pheats-pr">
              Change<span class="govuk-visually-hidden"> </span>
            </a>
          </td>
        </tr>

      </tbody>
    </table>

      <h2 class="govuk-heading-m">Authorised people</h2>

      {% set _apCount = data['apCount'] or 1 | int %}

      <table class="govuk-table govuk-!-margin-bottom-9">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header" scope="col">Name</th>
            <th class="govuk-table__header" scope="col">Position</th>
            <th class="govuk-table__header" scope="col">Contact details</th>
            <th class="govuk-table__header" scope="col" style="text-align: right;">Actions</th>
          </tr>
        </thead>
        <tbody>

        {% for i in range(0, _apCount) -%}

        {% set _show = "true" %}
        {% set _id = loop.index %}
        {% set _deletedValue = data['apDeleted'+_id] %}
        {% if _deletedValue == "true" %}
          {% set _show = "false" %}
        {% endif %}

        {% if _show == "true" %}
        <tr class="govuk-table__row">
          <td class="govuk-table__cell">
            {{data['apName' + _id] or 'Jane Doe'}}
          </td>
          <td class="govuk-table__cell">
            {{data['apPosition' + _id] or 'Manager'}}
          </td>
          <td class="govuk-table__cell">
            {{data['apEmail' + _id] or 'email@email.com'}}
          </td>
          <td class="govuk-table__cell" style="text-align: right;">
            <a class="govuk-link govuk-link--no-visited-state" href="pheats-aps-added">
              Change<span class="govuk-visually-hidden"> </span>
            </a>
          </td>
        </tr>
        {% endif %}

        {%- endfor %}

      </tbody>
    </table>

      <h2 class="govuk-heading-m">
        Declaration
      </h2>
  
      <p class="govuk-body">
        By submitting this application form, you are agreeing with the <a class="govuk-link govuk-link--no-visited-state" href="#" target="_blank">terms and conditions (opens in new tab)</a> of the plant health exports audited trader scheme (PHEATS).
      </p>

      <div class="govuk-form-group govuk-!-margin-bottom-9">
        <fieldset class="govuk-fieldset" >
          <div class="govuk-checkboxes" data-module="govuk-checkboxes">
            <div class="govuk-checkboxes__item">
              <input class="govuk-checkboxes__input" id="pheatsDeclaration" name="pheatsDeclaration" type="checkbox" value="Yes">
              <label class="govuk-label govuk-checkboxes__label" for="pheatsDeclaration">
                I confirm that I have understood and followed the terms and conditions.
              </label>
            </div>
          </div>

        </fieldset>
      </div>

      <!-- 
        Reset authorised people counts and data so if you add another pheats reg it is reset 
      -->
      {% for i in range(0, _apCount) -%}
        {% set _id = loop.index %}
        <input id="apName{{_id}}" name="apName{{_id}}" type="hidden" value="">
        <input id="apPosition{{_id}}" name="apPosition{{_id}}" type="hidden" value="">
        <input id="apEmail{{_id}}" name="apEmail{{_id}}" type="hidden" value="">
        <input id="apDeleted{{_id}}" name="apDeleted{{_id}}" type="hidden" value="false">
      {%- endfor %}
      <input id="apCount" name="apCount" type="hidden" value="0">
      <input id="apDisplayedCount" name="apDisplayedCount" type="hidden" value="0">

      <!-- 
        Reset commodity counts and data so if you add another pheats reg it is reset 
      -->
      {% for i in range(0, _commodityCount) -%}
        {% set _id = loop.index %}
        <input id="commodityVariety{{_id}}" name="commodityVariety{{_id}}" type="hidden" value="">
        <input id="commodityName{{_id}}" name="commodityName{{_id}}" type="hidden" value="">
        <input id="commodityDeleted{{_id}}" name="commodityDeleted{{_id}}" type="hidden" value="false">
        {% for i in range(0, data['originCount' + _id] or 1 | int) -%}
          <input id="commodityOriginDeleted{{_id}}-{{loop.index}}" name="commodityOriginDeleted{{_id}}-{{loop.index}}" type="hidden" value="false" >
          <input id="commodityOrigin{{_id}}-{{loop.index}}" name="commodityOrigin{{_id}}-{{loop.index}}" type="hidden" value="" >
        {%- endfor %}
        <input id="originCount{{_id}}" name="originCount{{_id}}" type="hidden" value="1">
        {% for i in range(0, data['destinationCount' + _id] or 1 | int) -%}
          <input id="commodityDestinationDeleted{{_id}}-{{loop.index}}" name="commodityDestinationDeleted{{_id}}-{{loop.index}}" type="hidden" value="false" >
          <input id="commodityDestination{{_id}}-{{loop.index}}" name="commodityDestination{{_id}}-{{loop.index}}" type="hidden" value="" >
        {%- endfor %}
        <input id="destinationCount{{_id}}" name="destinationCount{{_id}}" type="hidden" value="1">
      {%- endfor %}
      <input id="commodityCount" name="commodityCount" type="hidden" value="0">
      <input id="commodityDisplayedCount" name="commodityDisplayedCount" type="hidden" value="0">


      {{ govukButton({
        text: "Accept and submit"
      }) }}

        
        <p class="govuk-body govuk-!-margin-top-2"><a href="pheats-applications" class="govuk-link govuk-link--no-visited-state">Save and continue later</a></p>

    </form>

  </div>
</div>

{% endblock %}
